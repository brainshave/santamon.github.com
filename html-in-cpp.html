<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8" />
    <link rel="alternate" type="application/atom+xml" title="Long-standing Bug" href="atom.xml" />
    <link rel="stylesheet" href="media/main.css" />

    <title>Embedded Declarative HTML in C++</title>
    <!-- work around IE (8?) not handling properly unknown tags -->
    <!-- suggested here: http://diveintohtml5.org/semantics.html -->
    <script>
      document.createElement("article");
      document.createElement("nav");
      document.createElement("aside");
      document.createElement("footer");
      document.createElement("time");
    </script>
  </head>
  <body>
    <div id="main_container">
      <div id="left_container">
        <header>
          <a href="index.html" id="logo"><img src="media/header.svg" /></a>
        </header>
        <article id="content">
  <time>2011-11-20</time>
  <h1>Embedded Declarative HTML in C++</h1>
  

<p>How about writing that in C++:</p>

<div class="highlight"><pre><code class="cpp"><span class="n">Node</span> <span class="n">html</span>
<span class="p">{</span><span class="s">&quot;html&quot;</span><span class="p">,</span> <span class="p">{{</span><span class="s">&quot;lang&quot;</span><span class="p">,</span> <span class="s">&quot;pl&quot;</span> <span class="p">}},</span> <span class="p">{</span> <span class="c1">// tag with attributes</span>
  <span class="p">{</span><span class="s">&quot;head&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="c1">// tag without attributes</span>
    <span class="p">{</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="s">&quot;Page Title&quot;</span> <span class="c1">// text node</span>
    <span class="p">}}</span>
  <span class="p">}},</span>
  <span class="p">{</span><span class="s">&quot;body&quot;</span><span class="p">,</span> <span class="p">{{</span><span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;background-color: #fff;&quot;</span><span class="p">}},</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">&quot;h1&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;Page Title&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s">&quot;div&quot;</span><span class="p">,</span> <span class="p">{}}</span> <span class="c1">// empty tag</span>
  <span class="p">}}</span>
<span class="p">}};</span>

<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">html</span><span class="p">;</span>
</code></pre>
</div>


<p>and getting that:</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;pl&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>
      Page Title
    <span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">&quot;background-color: #fff;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>
      Page Title
    <span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>


<p>Clojure has the <a href="https://github.com/weavejester/hiccup">Hiccup</a> and
Groovy has it&rsquo;s
<a href="http://groovy.codehaus.org/Creating+XML+using+Groovy%27s+MarkupBuilder">builders</a>
for XML/HTML generation. I saw today a
<a href="http://www.infoq.com/presentations/The-Kotlin-Programming-Language">presentation</a>
with an example of this in
<a href="http://confluence.jetbrains.net/display/Kotlin/Welcome">Kotlin</a>, with
static typing&hellip;</p>

<p>I wanted to see if something like this is possible in C++. It turned
out that with help of some newest and freshest stuff in
<a href="http://en.wikipedia.org/wiki/C%2B%2B11">C++11</a> it was pretty
straight-forward.</p>

<div class="subsection_number h2">1</div>


<h2><code>std::initializer_list</code></h2>


<p>C++11 introduced the
<a href="http://en.wikipedia.org/wiki/C%2B%2B11#Initializer_lists"><code>std::initializer_list</code></a>
type which is a neat enhancement to C&rsquo;s intializer lists. C&rsquo;s
initializer lists are a way for creating arrays and structs:</p>

<div class="highlight"><pre><code class="c"><span class="kt">int</span> <span class="n">array</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">};</span>
<span class="k">struct</span> <span class="p">{</span> <span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span> <span class="n">number</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">};</span>
</code></pre>
</div>


<p>C++&rsquo;s <code>std::initializer_list</code> is a clever enhancement because it&rsquo;s an
runtime object which knows how many elements are in it and are created
automatically by the compiler. It&rsquo;s useful in functions and
constructors when you want to pass some inlined data structures, for
example a function:</p>

<div class="highlight"><pre><code class="cpp"><span class="kt">int</span> <span class="n">sum</span><span class="p">(</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">numbers</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// a proper foreach is also a C++11 feature</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="n">numbers</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>


<p>could be used like: <code>sum({1, 2, 3, 4});</code>.</p>

<p>New implementations of STL containers (such as <code>vector</code>s) support that
in constructors so you can fill them with data in construction time:</p>

<div class="highlight"><pre><code class="cpp"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">nums</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
</code></pre>
</div>




<div class="subsection_number h2">2</div>


<h2>Proof'O'Concept</h2>


<p>In my humble proof of concept I just extended the use of
<code>std::initializer_list</code>. Each node in tree is either:</p>

<ul>
<li>a text node (constructor with one string arg)</li>
<li>a tag with attributes (each attribute is a pair of name and value) and children (nested nodes, so it&rsquo;s recursive)</li>
<li>a tag without attributes but with children (if a tag is childless you have to pass an empty children list, otherwise it will be treated as a text node)</li>
</ul>


<p>For each variant there&rsquo;s a different constructor. That&rsquo;s pretty much
it. I&rsquo;ve pasted a complete <a href="https://gist.github.com/1380325/">gist</a> at
the end of this article. Probably the longest and least interesting
part is the <code>render()</code> method, but somewhat obligatory to see if the
whole thing works at all.</p>

<div class="didascalia"><p>Without macros! ;)</p>
</div>


<p>In C++11, solution is straight-forward and maybe even handsome but I am
most curious how it could be done in older versions of C++. I think
that <code>initializer_list</code>s and other new features of C++11 (lambdas!)
made it possible to create more sophisticated internal DSLs than the
one presented here. I actually believe it <em>is</em> now possible to implement
something like <a href="http://github.com/santamon/GUIFTW">GUI FTW</a> in C++.</p>

<div class="didascalia"><p>The source code will probaly not be embedded in RSS reader. Read it on <a href="http://longstandingbug.com/html-in-cpp.html">my site</a> or on <a href="https://gist.github.com/1380325/">gist.github.com</a>.</p>
</div>


<script src="https://gist.github.com/1380325.js"> </script>




<div>
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'longstandingbug'; // required: replace example with your forum shortname

  // The following are highly recommended additional parameters. Remove the slashes in front to use.
  
  
  
  var disqus_identifier = 'html-in-cpp.html';
  var disqus_url = 'http://longstandingbug.com/html-in-cpp.html';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>


</article>

      </div>
      <div id="right_container">
        <nav id="meta_menu">
          <a href="index.html">Home</a><br />
          <a href="atom.xml">Atom</a><br />
          <a href="info.html">Author</a><br />
          <a href="http://twitter.com/szywon">Twitter</a><br />
          <a href="http://github.com/santamon">GitHub</a>
        </nav>
        <nav id="projects_menu">
          <p>Projects:</p>
          <a href="http://github.com/santamon/GUIFTW">GUI FTW!</a><br />
          <a href="http://github.com/santamon/sroo">Sroo</a>
        </nav>
        <nav id="catogries_menu">
          <p>Categories:</p>
          <a href="clojure-category.html">Clojure</a><br />
          <a href="gui-ftw-category.html">GUI</a><br />
          <a href="javascript-category.html">JavaScript</a>
        </nav>
        <nav id="links_menu">
          <p>Links:</p>
          <a href="http://radek.pycka.com">Radek Pycka</a><br />
          <a href="http://blog.charmas.pl">Michał Charmas</a><br />
          <a href="http://konradhalas.blogspot.com/">Konrad Hałas</a><br />
          <a href="http://infoq.com">InfoQ</a>
        </nav>
        <nav id="archive_menu">
          <p>Archive:</p>
          
          




<label for="November_2011">November 2011</label>
<input id="November_2011" type="checkbox" />
<ul>



<li><time datetime="2011-11-20">
    20
</time> <a href="html-in-cpp.html">Embedded Declarative HTML in C++</a></li>




</ul>
<label for="September_2011">September 2011</label>
<input id="September_2011" type="checkbox" />
<ul>



<li><time datetime="2011-09-23">
    23
</time> <a href="sroo.html">Another HTML/JavaScript Slideshow Library</a></li>






<li><time datetime="2011-09-11">
    11
</time> <a href="whys-behind-new-design.html">The Whys Behind This New Freaky Design</a></li>




</ul>
<label for="June_2011">June 2011</label>
<input id="June_2011" type="checkbox" />
<ul>



<li><time datetime="2011-06-20">
    20
</time> <a href="sound-synthesis.html">Sound Synthesis & Playback in Clojure</a></li>




</ul>
<label for="May_2011">May 2011</label>
<input id="May_2011" type="checkbox" />
<ul>



<li><time datetime="2011-05-22">
    22
</time> <a href="webglol.html">WebGLOL</a></li>






<li><time datetime="2011-05-16">
    16
</time> <a href="reintroducing-guiftw.html">Reintroducing GUI FTW! and Progress Report</a></li>






<li><time datetime="2011-05-07">
    7
    
</time> <a href="restarting-in-english-mode.html">Restarting in English Mode</a></li>




</ul>
<label for="April_2011">April 2011</label>
<input id="April_2011" type="checkbox" />
<ul>



<li><time datetime="2011-04-04">
    4
    
</time> <a href="zdarzenia-guiftw.html">Zdarzenia w GUI FTW!</a></li>




</ul>
<label for="March_2011">March 2011</label>
<input id="March_2011" type="checkbox" />
<ul>



<li><time datetime="2011-03-20">
    20
</time> <a href="niech-sie-stanie-gui-ftw.html">Niech się stanie GUI FTW!</a></li>




</ul>
<label for="October_2010">October 2010</label>
<input id="October_2010" type="checkbox" />
<ul>



<li><time datetime="2010-10-16">
    16
</time> <a href="idea-iluzja.html">Idea i Iluzja łeb w web</a></li>




</ul>
<label for="September_2010">September 2010</label>
<input id="September_2010" type="checkbox" />
<ul>



<li><time datetime="2010-09-03">
    3
    
</time> <a href="blad-mlodego-parsownika.html">Błąd młodego parsownika</a></li>




</ul>
<label for="August_2010">August 2010</label>
<input id="August_2010" type="checkbox" />
<ul>



<li><time datetime="2010-08-16">
    16
</time> <a href="intro.html">Intro</a></li>




</ul>
<label for="January_2010">January 2010</label>
<input id="January_2010" type="checkbox" />
<ul>



<li><time datetime="2010-01-07">
    7
    
</time> <a href="efekty-uboczne-programowania.html">Efekty uboczne programowania</a></li>




</ul>
<label for="June_2009">June 2009</label>
<input id="June_2009" type="checkbox" />
<ul>



<li><time datetime="2009-06-07">
    7
    
</time> <a href="one-makefile-to-rule-them-all.html">One Makefile To Rule Them All</a></li>


</ul>


        </nav>
      </div>
    </div>
    <footer><div>Copywrong 2011 Szymon Witamborski</div></footer>
    <script src="media/hyphenator.js"></script>
    <!-- google analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23922729-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
