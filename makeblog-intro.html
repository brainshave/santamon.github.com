<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="media/bug-inv.ico" type="image/x-icon" />
    <link rel="stylesheet" href="media/fonts.css" />
    <link rel="stylesheet" href="media/makeblog.css" />
    <link rel="stylesheet" href="media/common.css" />
    <link rel="stylesheet" href="media/article.css" />
    <title>Makeblog: je się z...</title>
    <!-- work around IE not handling properly unknown tags -->
    <!-- suggested here: http://diveintohtml5.org/semantics.html -->
    <script>
      document.createElement("article");
      document.createElement("nav");
      document.createElement("aside");
      document.createElement("footer");
      document.createElement("date");
    </script>
  </head>
  <body>
    <div id="main_wrapper">
      <div id="header">
	<div id="sw"><a href="index.html">S/W</a></div>
	<nav id="menu">
	  <a href="archive.html">Archiwa</a>,
	  <a href="info.html">Info</a>
	</nav>
      </div>
      <div id="latest">
	<time id="latest_text">sobota, 21 sierpień 2010</time>
	<article>
	  <h1>Makeblog: je się z...</h1>
	  <p>Makeblog powstał dla mojej własnej przyjemności. Poza przyczyną powstania (Hej, można by tu przytoczyć
argument przyczyny powstania czegokolwiek...) wszystkie dalsze decyzje wyglądają całkiem logicznie.
</p><h2>Marketing</h2><p>Co daje Makeblog? W kilku punktach:
</p><ol>
<li>Generuje Twojego bloga na Twoim komputerze. = Problem backupu rozwiązany o ile sam[a] je robisz :P .</li>
<li>Wysyłasz wygenerowane pliki na wybrany hosting, możesz synchronizować go łatwo między wieloma serwerami.</li>
<li>Szybkość. Są to gotowe, wygenerowane pliki HTML, co znaczy, że nie ma miliarda odwołań do bazy danych za każdym otwarciem strony.</li>
<li>Możesz pisać bloga w swoim ulubionym edytorze tekstowym. <strong>Giń, o TEXTAREA !!</strong></li>
<li>Domyślna składnia plików tekstowych jest prosta, coś jak ASCII art dla HTML-a. (zostanie omówiona za jakiś czas).</li>
<ul>
<li>Domyślną składnię można zmienić ;) .</li>
</ul>
<li>Tworzenie szablonów jest niesłychanie proste (i ograniczone za razem ;) ).</li>
<ul>
<li>Zapomniałem wspomnieć, że pliki generowane są na podstawie szablonów ;) .</li>
</ul>
<li>Pisanie i instalacja rozszerzeń są banalnie proste i można je pisać w dowolnym języku.</li>
</ol><h2>Dlaczego <strong>make</strong>  ?</h2><p>Make wygląda na przesłuszny wybór, gdy chodzi o kompilację wielu plików z jednej formy do drugiej.
Przy tym kompilowane są tylko te cele, które są starsze od plików, z których powstały.
Oczywiście tak samo dobry byłby każdy inny system jak np. jam czy ant...
Make'a po prostu znam (trochę). Kiedyś bawiłem się także jamem (zaciekawił mnie dlatego, że jest używany
do budowania <a href="http://haiku-os.org">Haiku</a> , w sensie do budowania <u>całego</u> systemu operacyjnego...).
Dodatkową motywacją było poćwiczenie mózgownicy. No bo kto dzisiaj z palca pisze Makefile'e... ;)
</p><h2>Zasada działania</h2><p>Najprościej ująć to tak: make zagląda do katalogu z plikami wejściowymi, dla każdego typu odpala
odpowiedni skrypt (np. inny dla plików graficznych, inny dla tekstowych, o czym więcej za chwilę,
przy okazji opisu rozszerzeń), który wypluwa odpowiedni plik do katalogu wyjściowego.
</p><h3>Kawałki wbudowane</h3><p>W Makeblog wbudowany jest tylko jeden element: indekser. Jest odpowiedzialny za kompilowanie
<a href="archive.html">archiwum</a> plików, głównej <a href="index.html">strony</a> i (w przyszłości) koryta RSS albo Atom
(serio, nie wiem jak przetłumaczyć <em>feed</em> , żeby oddało to sens oryginału ;) ).
</p><h3>Pisanie wtyczek</h3><p>Rozszerzanie Makeblog jest bardzo łatwe. Instalacja rozszerzenia polega na wrzuceniu jej do katalogu
z Makeblogiem. Rozszerzenie powinno składać się z przynajmniej jednego pliku <code>Makefile</code> lub <code>*.mk</code> .
To, co robi z plikami wejściowymi jest już prywatną sprawą autora wtyczki. Nie jest jednak pozostawiony
sam[a] sobie i stworzyłem kilka makr, które będą pomocne:
</p><ul>
<li><code>ALL_TARGETS</code> : dodajemy do niego wszystkie pliki, które składają się na bloga (przez operator <code>+=</code> ), np. pliki <a href="*.html">@~</a>@, które będą wynikiem działania naszej wtyczki.</li>
<li><code>INDEXED_TARGETS</code> : dodajemy do niego wszystkie pliki, które chcemy, by zostały zindeksowane. (Tak naprawdę to tutaj musimy wygenerować pliki z metadanymi, zawierające wyekstraktowane tytuł, datę, itd.)</li>
</ul><p>Z innej strony zasadę działania można opisać tak: Makeblog najpierw przetworzy wszystkie pliki z <code>ALL_TARGETS</code> a później
wygeneruje archiwum i indeks na podstawie <code>INDEXED_TARGETS</code> .
</p><h3>Pierwsza wtyczka: txt-to-html</h3><p>Pierwszym rozszerzeniem (włączonym do Makebloga) jest @txt-to-html@. Parsuje pliki tekstowe (z najprostszą
z możliwych składni, wierzcie mi ;) ). Sama składnia jest częściowo ukradziona z <a href="http://orgmode.org">org-mode'a</a> ale uprościłem
ją nieco na własne potrzeby. Będzie omówiona wkrótce, w osobnym wpisie.
</p><p>Myślę, że <a href="http://bazaar.launchpad.net/~santamon/makeblog/trunk/annotate/head%3A/txt-to-html/txt-to-html.mk">Makefile z tej wtyczki</a>
jest dobrym punktem startowym dla pisania nowych. Myślę, że o pisaniu wtyczek pojawi się wpis w bliskiej przyszłości.
</p><h2>Python zamiast Clojure WTF</h2><p>Generalnie rozszerzenia do Makeblog można pisać w <strong>dowolnym</strong> języku. Ludzie, którzy mnie znają osobiście wiedzą,
że mam lekkie zboczenie na temat Clojure.
Indekser i parser są napisane w Pythonie z tych powodów:
</p><ol>
<li>JVM+Clojure wolno startują.</li>
<ul>
<li>Najpierw odpalona musi zostać JVM, później jeszcze samo Clojure, w sumie 2s (na moim sprzęcie). Jest to niewybaczalne jeśli ma być skrypt/program ma być odpalany osobno dla każdego pliku wejściowego.</li>
<li>Python i inne języki skryptowe są interpretowane i startują zazwyczaj pomijalnie szybko.</li>
</ul>
<li>Główna logika parsera zawarta jest w wyrażeniach regularnych.</li>
<ul>
<li>W takim przypadku język programowania jest sprawą drugorzędną, o ile mają wsparcie dla wyr. reg.. Oba mają.</li>
<li>Podobno parserów <a href="http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454">nie powinno</a> się pisać wyłącznie w wyrażeniach regularnych ;), no cóż :P</li>
</ul>
<li>Pythona znam. Pamiętam, że 2 lata temu, jak uczyłem się Ruby'ego napisałem coś podobnego w nim, Lecz:</li>
<ul>
<li>Ruby'ego już nie pamiętam.</li>
<li>Skrypt zagubiłem między formatami/zmianami kompów/itd., zostawmy więc to w kategorii legend, które będę opowiadał wnukom.</li>
</ul></ol><p>Ponieważ (2) i (3) są <em>in plus</em> dla Pythona, (1) jest <em>in minus</em> dla Clojure, (3) jest <em>in minus</em> dla Ruby'ego,
wygrywa Python.\\
<em>c.b.d.u.</em>
</p>
	</article>
      </div>
      <footer>
	&copy; 2010 Szymon Witamborski
      </footer>
    </div>
  </body>
</html>
