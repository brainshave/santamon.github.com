<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="media/bug-inv.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Long-standing Bug" href="atom.xml" />
    <link rel="stylesheet" href="media/makeblog.css" />
    <link rel="stylesheet" href="media/common.css" />
    <link rel="stylesheet" href="media/article.css" />

    <link rel="stylesheet" href="media/fonts.css" />

    <title>Zdarzenia w GUI FTW!</title>
    <!-- work around IE not handling properly unknown tags -->
    <!-- suggested here: http://diveintohtml5.org/semantics.html -->
    <script>
      document.createElement("article");
      document.createElement("nav");
      document.createElement("aside");
      document.createElement("footer");
      document.createElement("date");
    </script>
    <script src="media/hyphenator.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="main_wrapper">
      <div id="header">
	<div id="sw">
	  <a href="index.html">
	    <img src="media/bug-crop.png" alt="Long-standing Bug" />
	  </a>
	</div>
	<nav id="menu">
	  <a href="archive.html">Archiwa</a>,
	  <a href="info.html">Info</a>
	</nav>
      </div>
      <div id="latest">
	<time id="latest_text">poniedziałek, 04 kwiecień 2011</time>
	<article class="hyphenate">
	  <h1>Zdarzenia w GUI FTW!</h1>
	  <p>Tradycyjnie w Swingu bądź SWT żeby obsłużyć zdarzenie musimy utworzyć
nową implementację jakiegoś interfejsu, np. <code>MouseListener</code> a potem
go zarejestrować w obiekcie, którego zdarzenia nas interesują.
</p><pre>button.addMouseListener(new MouseListener() {
    public void mouseClicked(MouseEvent event) {
        //... obsługa zdarzenia
    }
    public void mouseEntered(MouseEvent event) {
        //... obsługa zdarzenia
    }
    public void mouseExited(MouseEvent event) {
        //... obsługa zdarzenia
    }
    public void mousePressed(MouseEvent event) {
        //... obsługa zdarzenia
    }
    public void mouseReleased(MouseEvent event) {
        //... obsługa zdarzenia
    }
});
</pre><p>Jeśli obchodzi nas tylko jedno zdarzenie, wygodnie jest dziedziczyć po
klasie <code>MouseAdapter</code>, która implementuje wszystkie metody jako puste,
wystarczy więc zaimplementować jedną metodę:
</p><pre>button.addMouseListener(new MouseAdapter() {
    public void mouseClicked(MouseEvent event) {
        //... obsługa zdarzenia
    }
});
</pre><p>Jak widać, trzeba się sporo opisać zanim dotrze się do miejsca, gdzie
umieści się właściwy kod, nawet w wersji z adapterem. Jeśli jest
możliwe napisanie kodu krótszego i przynajmniej tak samo dobrze
wyrażającego co chcemy osiągnąć to moim zdaniem warto.
</p><h2>Jak to wygląda w GUI FTW!?</h2><p>Obsługę zdarzeń wrzucamy do arkuszy stylów. Wygląda to tak jak każda
inna właściwość (tekst, kolor, itd.) poza tym, że nazwą właściwości
jest specyfikacja zdarzenia a wartością jest funkcja która je obsłuży.
Dzięki temu zyskujemy również na wszystkich zaletach arkuszy stylów,
np. można obsłużyć zdarzenia z wielu obiektów na raz.
</p><pre>(stylesheet [[:cos :drugie-cos] [:text "Coś!"
                                 &lt;spec-zdarzenia&gt; &lt;funkcja&gt;]])
</pre><h3>Specyfikacja zdarzenia</h3><p>GUI FTW! musi znać dwie rzeczy: nazwę interfejsu *Listener i jedną
metodę do zaimplementowania &mdash; nazwę zdarzenia. Trzeba to podać w
takiej formie:
</p><pre>&lt;nazwa interfejsu&gt;+&lt;nazwa metody&gt;
</pre><p>Czyli np. <code>mouse+mouse-clicked</code> albo
<code>action+action-performed</code>. Odpada dzięki temu spora część zbędnego
kodu z pierwszego przykładu. Widać coś jeszcze: np. w
<code>mouse+mouse-clicked</code> słowo <code>mouse</code> powtarza się. Ponieważ występuje
to dość często dodałem skrót: jeśli napiszemy <code>++</code> zamiast <code>+</code> możemy
pozbyć się zbędnego słowa.
</p><pre>mouse++clicked -&gt; mouse+mouse-clicked -&gt; MouseListener.mouseClicked
</pre><h4>Dlaczego nie uniwersalne <code>on-click</code> albo <code>on-mouse-over</code>?</h4><p>Takie rozwiązanie na pewno byłoby intuicyjne dla osób
początkujących. Nie widzę jednak sensu gdy <code>mouse++clicked</code> jest
wystarczająco wymowne. Poza tym powodowałoby zwiększenie kodu w GUI
FTW! specyficznego dla bibliotek, które obsługuje (w tym momencie
Swing i SWT).
</p><p>Dzięki temu, że GUI FTW! wymaga podania nazwy interfejsu i metody,
możliwa jest obsługa zdarzeń wymyślonych przez programistę na poziomie
równym z tymi wbudowanymi w Swing bądź SWT.
</p><h3>Funkcja obsługująca</h3><p>W tym momencie funkcja obsługująca zdarzenie ma jeden argument:
zdarzenie, które wystąpiło. Może to być zarówno funkcja anonimowa jak
i nazwa funkcji zdefiniowanej w innym miejscu.
</p><h2>Przykład</h2><p>Rozwinę lekko przykład z poprzedniego wpisu (utrzymując poziom
hellołłorldowy). Dla przypomnienia struktura interfejsu:
</p><pre>(def window 
  (swing
    [JFrame [*id :okno-ftw]
     [JButton [*id :przycisk-omg]]]))
</pre><p>Do arkusza styli dodamy obsługę zdarzenia:
</p><pre>(def sheet
 (stylesheet
  [:okno-ftw] [:title "GUI FTW!"
               :size ^unroll (300 200)
               :visible true]
  [:przycisk-omg] [:text "To jest przycisk!"
                   :mouse++clicked
                   (fn [event]
                    (JOptionPane/showMessageDialog nil "GUI FTW!"))]))
</pre><p><img src="gui-ftw-pierwsza-akcja.png" alt="Prosty przykład podpięcia akcji pod przycisk" />
</p><p>Pełny kod tego przykładu znajduje się <a href="https://github.com/santamon/GUIFTW/blob/master/src/guiftw/examples/swing/basic.clj">tutaj</a>.
</p>
	</article>
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	  var disqus_shortname = 'longstandingbug'; // required: replace example with your forum shortname

	  // The following are highly recommended additional parameters. Remove the slashes in front to use.
	  var disqus_identifier = 'zdarzenia-guiftw.html';
	  var disqus_url = 'http://longstandingbug.com/zdarzenia-guiftw.html';

	  /* * * DON'T EDIT BELOW THIS LINE * * */
	  (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	  })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
      <footer>
	&copy; 2010-2011 Szymon Witamborski, <a href="info.html">CC by</a>
      </footer>
    </div>
  </body>
</html>
