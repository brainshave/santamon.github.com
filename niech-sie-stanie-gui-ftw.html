<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <link rel="alternate" type="application/atom+xml" title="Long-standing Bug" href="atom.xml" />
    <link rel="stylesheet" href="media/main.css" />

    <title>Niech się stanie GUI FTW!</title>
    <!-- work around IE (8?) not handling properly unknown tags -->
    <!-- suggested here: http://diveintohtml5.org/semantics.html -->
    <script>
      document.createElement("article");
      document.createElement("nav");
      document.createElement("aside");
      document.createElement("footer");
      document.createElement("time");
    </script>
  </head>
  <body>
    <div id="main_container">
      <div id="left_container">
        <header>
          <a href="index.html" id="logo"><img src="media/header.svg" /></a>
        </header>
        <article id="content">
  <time>2011-03-20</time>
  <h1>Niech się stanie GUI FTW!</h1>
  

<p>Ponieważ bardzo lubię programowanie deklaratywne brakowało mi od dawna
czegoś deklaratywnego do tworzenia GUI. Kod tworzący GUI jest zawsze
bardzo nudny i powtarzalny: &ldquo;stwórz obiekt, ustaw jego tekst, ikonę,
dodaj akcję na klik (wcześniej stwórz obiekt implementujący
odpowiedniego listenera), ew. stwórz obiekty-dzieci, bla bla bla&rdquo;.</p>

<p>Projektanci stron internetowych od początku mają do dyspozycji HTML i
CSS, które są jak najbardziej deklaratywne w swojej naturze. Dodatkowo
treść określa się osobno od tego jak ma wyglądać. Model ten zaczyna
wychodzić poza przeglądarki, np. XAML w .NET albo pliki layoutów w
Androidzie. Wszystkie znane mi do tej pory tego przykłady opierają się
na XML-u i dodatkowym programie generującym kod w trakcie kompilacji.</p>

<p>Ostatnio pracuję nad podobną biblioteką dla Clojure. Są jednak dwie
główne różnice:</p>

<ol>
<li>Tak jak dla programistów Javy naturalnym językiem do opisu danych
jest XML tak dla programistów Clojure tym językiem jest Clojure.</li>
<li>Moja biblioteka jest jedynie biblioteką, nie wymaga dodatkowych
programów generujących (powiedzmy) kod Javy z XML-a.</li>
</ol>


<p>Ad 1. Składnia Clojure to tylko struktury danych: listy, wektory i
mapy o <em>wybornej</em> składni. Grzechem byłoby używać w takiej sytuacji
XML-a. Całe parsowanie robi za mnie Clojure więc mogę martwić się już
tylko znaczeniem tego co siedzi w środku. Zarówno drzewo GUI (analogia
do HTML) jak i style (CSS) definiowane są za pomocą kodu w Clojure.</p>

<p>Ad 2. Dzięki magicznym technikom metaprogramowania (makrom) mogę
wchodzić w drogę kompilatorowi Clojure i generować kod tuż przed
kompilacją zamiast generować kod programem i dopiero potem wywoływać
kompilator. Dlatego całą funkcjonalność można spakować do pliku jar i
używać jak każdej innej biblioteki. Ułatwia to także programowanie
interaktywne z użyciem REPL.</p>

<h2>Co, gdzie, jak?</h2>

<p>Teraz nieco więcej o samej bibliotece. Nazwałem ją <strong>GUI FTW!</strong> a pobrać
ją można stąd: <a href="http://github.com/santamon/GUIFTW">http://github.com/santamon/GUIFTW</a>. Jest dostępna
także na <a href="http://clojars.org/guiftw">Clojars</a> więc wystarczy dodać
<code>[guiftw "0.1.0-SNAPSHOT"]</code> do zależności projektu aby jej
użyć. Polecam poeksperymentować z przykładami w katalogu
<a href="http://github.com/santamon/GUIFTW/blob/master/src/guiftw/examples">src/guiftw/examples</a>,
które są również mocno obkomentowane w formie tutoriala.</p>

<p>GUI FTW! nie jest kolejnym toolkitem obok SWT i Swinga &mdash; jest
deklaratywną nakładką na nie. Tzn. GUI FTW! można używać do tworzenia
interfejsów używając jednego albo drugiego pod spodem. Do tego zostało
napisane na tyle abstrakcyjnie, że można łatwo dopisać obsługę
kolejnego toolkitu. Ułatwi to przesiadkę programistom Javy, którzy
znają jedno albo drugie. Poza tym, pisanie kolejnego toolkitu nie jest
po prostu celem tego projektu.</p>

<h2>Banalny przykład</h2>

<p>Strukturą GUI jest drzewo, którego węzeł składa się z nazwy
klasy, listy właściwości oraz z jego węzłów-dzieci.</p>

<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">window</span>
 <span class="p">(</span><span class="nf">swing</span>
   <span class="p">[</span><span class="nv">JFrame</span> <span class="p">[</span><span class="nv">:title</span> <span class="s">&quot;GUI FTW!&quot;</span>
            <span class="nv">:visible</span> <span class="nv">true</span><span class="p">]</span>
    <span class="p">[</span><span class="nv">JButton</span> <span class="p">[</span><span class="nv">:text</span> <span class="s">&quot;To jest przycisk!&quot;</span><span class="p">]]]))</span>
</code></pre>
</div>


<p>Wewnątrz listy cech można używać dowolnych nazw, które mają swoje
settery w danej klasie. Np. <code>:title</code> tłumaczone jest na wywołanie
metody <code>setTitle</code>, <code>:default-close-operation</code> na
<code>setDefaultCloseOperation</code> itd.</p>

<p>Aby zdefiniować style osobno musimy nadać elementom identyfikatory:</p>

<div class="highlight"><pre><code class="clojure"><span class="p">[</span><span class="nv">JFrame</span> <span class="p">[</span><span class="nv">*id</span> <span class="nv">:okno-ftw</span><span class="p">]</span>
 <span class="p">[</span><span class="nv">JButton</span> <span class="p">[</span><span class="nv">*id</span> <span class="nv">:przycisk-omg</span><span class="p">]]]</span>
</code></pre>
</div>


<p>a osobno w tzw. arkuszu stylów zdefiniować cechy obiektów:</p>

<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">sheet</span>
 <span class="p">(</span><span class="nf">stylesheet</span>
  <span class="p">[</span><span class="nv">:okno-ftw</span><span class="p">]</span> <span class="p">[</span><span class="nv">:title</span> <span class="s">&quot;GUI FTW!&quot;</span>
               <span class="nv">:size</span> <span class="nv">^unroll</span> <span class="p">(</span><span class="mi">300</span> <span class="mi">200</span><span class="p">)</span>
               <span class="nv">:visible</span> <span class="nv">true</span><span class="p">]</span>
  <span class="p">[</span><span class="nv">:przycisk-omg</span><span class="p">]</span> <span class="p">[</span><span class="nv">:text</span> <span class="s">&quot;To jest przycisk!&quot;</span><span class="p">]))</span>
</code></pre>
</div>


<p>Składnia styli składa się z par list: najpierw lista identyfikatorów,
druga lista jest listą właściwości jak poprzednio. <code>^unroll</code> jest
potrzebne dla setterów, które mają więcej niż jeden parametr. Lista
poprzedzona <code>^unroll</code> zostanie rozwinięta na wszystkie jego parametry
zamiast wywołać setter z listą jako parametrem. Czyli otrzymamy
odpowiednik <code>setSize(300, 200)</code> zamiast <code>setSize((300, 200))</code>.</p>

<p>Makro <code>swing</code> zwraca funkcję, która utworzy chciane GUI, więc <code>window</code>
będzie funkcją. Parametrami tej funkcji jest ew. obiekt nadrzędny
(jeśli nie tworzylibyśmy okna tylko jakiś podrzędny element, może być
nil) oraz dowolna ilość arkuszy styli. Utworzenie okna będzie więc
wyglądało tak:</p>

<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="nf">window</span> <span class="nv">nil</span> <span class="nv">sheet</span><span class="p">)</span>
</code></pre>
</div>


<p><img src="images/gui-ftw-pierwsze-okno.png" alt="Pierwsze okno" /></p>

<p>Arkuszy może być więcej, możemy także podać inny komplet. Możemy też
utworzyć wiele okien wywołując powtórnie tę funkcję. Zwrócony zostanie
element na korzeniu drzewa.</p>

<p>Analogiczny przykład w SWT użyłby klas specyficznych dla SWT i przede
wszystkim makra <code>swt</code> zamiast <code>swing</code>.</p>

<h2>Co dalej</h2>

<p>Zacząłem pisać dokumentację. Jest dostępna w kodzie bądź przez <code>doc</code> w
REPL-u. Przydałaby się też dokumentacja on-line w stylu <a href="http://clojure.github.com/clojure/">tej dla samego Clojure</a>.</p>

<p>W tym momencie można stworzyć GUI, ostylować go i podpiąć zdarzenia (o
czym będzie następny wpis). Brakuje całej części &ldquo;stanowej&rdquo;, w
szczególności wyciąganie z drzewa interesujących nas elementów. Mam
również pomysł, by podpinać wartości (np. tekst pola tekstowego)
dwustronnie pod clojure'owe atomy, refy, agentów itp. Pozwoliłoby to
na spięcie GUI i np. pamięci transakcyjnej.</p>



<div>
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'longstandingbug'; // required: replace example with your forum shortname

  // The following are highly recommended additional parameters. Remove the slashes in front to use.
  
  
  
  var disqus_identifier = 'niech-sie-stanie-gui-ftw.html';
  var disqus_url = 'http://longstandingbug.comniech-sie-stanie-gui-ftw.html';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>


</article>

      </div>
      <div id="right_container">
        <nav id="meta_menu">
          <a href="index.html">Home</a><br />
          <a href="atom.xml">Atom</a><br />
          <a href="info.html">Author</a><br />
          <a href="http://twitter.com/szywon">Twitter</a><br />
          <a href="http://github.com/santamon">GitHub</a>
        </nav>
        <nav id="projects_menu">
          <p>Projects:</p>
          <a href="http://github.com/santamon/GUIFTW">GUI FTW!</a><br />
          <a href="http://github.com/santamon/sroo">Sroo</a>
        </nav>
        <nav id="catogries_menu">
          <p>Categories:</p>
          <a href="clojure-category.html">Clojure</a><br />
          <a href="gui-ftw-category.html">GUI</a><br />
          <a href="javascript-category.html">JavaScript</a>
        </nav>
        <nav id="links_menu">
          <p>Links:</p>
          <a href="http://radek.pycka.com">Radek Pycka</a><br />
          <a href="http://blog.charmas.pl">Michał Charmas</a><br />
          <a href="http://konradhalas.blogspot.com/">Konrad Hałas</a><br />
          <a href="http://infoq.com">InfoQ</a>
        </nav>
        <nav id="archive_menu">
          <p>Archive:</p>
          
          




<label for="November_2011">November 2011</label>
<input id="November_2011" type="checkbox" />
<ul>



<li><time datetime="2011-11-20">
    20
</time> <a href="html-in-cpp.html">Embedded Declarative HTML in C++</a></li>




</ul>
<label for="September_2011">September 2011</label>
<input id="September_2011" type="checkbox" />
<ul>



<li><time datetime="2011-09-23">
    23
</time> <a href="sroo.html">Another HTML/JavaScript Slideshow Library</a></li>






<li><time datetime="2011-09-11">
    11
</time> <a href="whys-behind-new-design.html">The Whys Behind This New Freaky Design</a></li>




</ul>
<label for="June_2011">June 2011</label>
<input id="June_2011" type="checkbox" />
<ul>



<li><time datetime="2011-06-20">
    20
</time> <a href="sound-synthesis.html">Sound Synthesis & Playback in Clojure</a></li>




</ul>
<label for="May_2011">May 2011</label>
<input id="May_2011" type="checkbox" />
<ul>



<li><time datetime="2011-05-22">
    22
</time> <a href="webglol.html">WebGLOL</a></li>






<li><time datetime="2011-05-16">
    16
</time> <a href="reintroducing-guiftw.html">Reintroducing GUI FTW! and Progress Report</a></li>






<li><time datetime="2011-05-07">
    7
    
</time> <a href="restarting-in-english-mode.html">Restarting in English Mode</a></li>




</ul>
<label for="April_2011">April 2011</label>
<input id="April_2011" type="checkbox" />
<ul>



<li><time datetime="2011-04-04">
    4
    
</time> <a href="zdarzenia-guiftw.html">Zdarzenia w GUI FTW!</a></li>




</ul>
<label for="March_2011">March 2011</label>
<input id="March_2011" type="checkbox" />
<ul>



<li><time datetime="2011-03-20">
    20
</time> <a href="niech-sie-stanie-gui-ftw.html">Niech się stanie GUI FTW!</a></li>




</ul>
<label for="October_2010">October 2010</label>
<input id="October_2010" type="checkbox" />
<ul>



<li><time datetime="2010-10-16">
    16
</time> <a href="idea-iluzja.html">Idea i Iluzja łeb w web</a></li>




</ul>
<label for="September_2010">September 2010</label>
<input id="September_2010" type="checkbox" />
<ul>



<li><time datetime="2010-09-03">
    3
    
</time> <a href="blad-mlodego-parsownika.html">Błąd młodego parsownika</a></li>




</ul>
<label for="August_2010">August 2010</label>
<input id="August_2010" type="checkbox" />
<ul>



<li><time datetime="2010-08-16">
    16
</time> <a href="intro.html">Intro</a></li>




</ul>
<label for="January_2010">January 2010</label>
<input id="January_2010" type="checkbox" />
<ul>



<li><time datetime="2010-01-07">
    7
    
</time> <a href="efekty-uboczne-programowania.html">Efekty uboczne programowania</a></li>




</ul>
<label for="June_2009">June 2009</label>
<input id="June_2009" type="checkbox" />
<ul>



<li><time datetime="2009-06-07">
    7
    
</time> <a href="one-makefile-to-rule-them-all.html">One Makefile To Rule Them All</a></li>


</ul>


        </nav>
      </div>
    </div>
    <footer><div>Copywrong 2011 Szymon Witamborski</div></footer>
    <script src="media/hyphenator.js"></script>
    <!-- google analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23922729-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
